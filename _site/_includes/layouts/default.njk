{%- import 'components/heading.njk' as heading -%}
{%- import 'components/social.njk' as social -%}
{%- import 'components/tooltip.njk' as tooltip -%}

{%- macro media(data=[], category='games') -%}
{%- for item in data %}
<li class="flex-1 justify-center {% if loop.index == 3 %}hidden xs:(flex){% else %}flex{% endif %}">
  <a href="{{ item.url }}" class="media-case media-{{ item.media }} group flex relative motion-safe:(transition-all) transform hover:(-translate-y-2)">
    <figure class="flex w-full">
      <img src="/_assets/img/media/{{ category }}/{{ item.media }}-{% if category == 'music' %}{{ item.sub | slugify }}-{% endif %}{{ item.title | slugify }}.jpg" alt="{{ item.title }}" class="w-full h-full" />
      <i class="bg-no-repeat absolute inset-0" style="background-image: url('/_assets/img/media/cases/{{ item.media}}.png');"></i>
      {%- call tooltip.x(as='figcaption') %}
        {%- if category == 'music' %}<small class="pb-px font-semibold leading-none block opacity-75">{{ item.sub }}:</small>{%- endif %}
        {{ item.title }}
        {%- if category == 'games' %}<small class="pt-px font-semibold leading-none block opacity-75">{{ item.sub }}</small>{%- endif %}
      {%- endcall %}
    </figure>
  </a>
</li>
{%- endfor %}
{%- endmacro -%}

<!doctype html>
<html lang="en" x-data="{% renderblock 'data' -%}" {% if page.url == '/' %}@work-modal.window="workData = $event.detail.data" {% endif %}x-cloak>

  <head>
    <meta charset="utf-8" />
    <meta http-equiv="x-ua-compatible" content="ie=edge" />
    <title>{%- if title -%}{{ title }} - {{ site.meta.title }}{%- else -%}{{ site.meta.title }} - {{ site.meta.description }}{%- endif -%}</title>
    <meta name="description" content="{{ site.meta.description }}" />
    <meta name="author" content="{{ site.meta.author + ' - '+ site.meta.url }}" />
    <meta name="generator" content="{{ eleventy.generator }}" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />

    <meta property="og:title" content="{{ site.meta.title }}" />
    <meta property="og:description" content="{{ site.meta.description }}" />
    <meta property="og:url" content="{{ site.meta.url }}{{ page.url }}" />
    <meta property="og:image" content="{{ site.meta.url }}/og-image.png" />
    <meta property="og:image:width" content="500" />
    <meta property="og:image:height" content="500" />
    <meta name="theme-color" content="#111111" />

    <link rel="icon" type="image/x-icon" href="/favicon.ico" />
    <link rel="apple-touch-icon" href="/apple-touch-icon.png" />
    <link rel="manifest" href="/site.webmanifest" />

    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" />
    <link rel="stylesheet" href="https://fonts.googleapis.com/css2?family=Inter:wght@100..900&display=swap" />

    {% set css %}
      {% include "css/prism.css" %}
    {% endset %}
    <style>{{ css | cssmin | safe }}</style>
    {% renderblock 'css' %}

    <script>
      if (localStorage.getItem('color-mode') === 'dark' || (window.matchMedia('(prefers-color-scheme: dark)').matches && !localStorage.getItem('color-mode'))) {
        document.documentElement.classList.add('dark');
      }
    </script>

  </head>

  <body class="bg-gray-100 text-gray-600" style="display: none;" data-instant-intensity="mousedown">
    <div class="app w-full min-h-screen flex-(& col) relative">
      <div class="bg-(paper gray-100) relative z-10">
        <b class="bg-(grid fixed) text-gray-100 absolute inset-0 opacity-5 dark:(opacity-30)" aria-hidden="true"></b>
        <b class="h-16 bg-(repeat-x bottom) absolute inset-x-0 bottom-0 invert dark:(invert-0)" style="background-image: url('/_assets/img/bg-grunge-bot.png');" aria-hidden="true"></b>
        <header class="w-full flex-none relative">
          <div class="mx-auto py-6 px-4 max-w-7xl relative lg:px-8">
            <nav class="flex items-center justify-between">
              <a href="/" class="p-1.5 w-12 h-12 bg-gray-800 text-gray-50 flex rounded-full transform motion-safe:(transition) hover:(motion-safe:(animate-blob))">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 200 200" role="img" class="fill-current">
                  <title>Craig Erskine logo</title>
                  <g fill-rule="evenodd">
                    <path d="M42.747122,81.9990174 C58.9655226,93.344021 78.7054673,100 100,100 C121.294533,100 141.034477,93.344021 157.252882,81.9990144 C155.193825,75.4436177 152.039977,69.3730608 148.005622,64.0016292 C134.634094,74.0472141 118.012221,80 100,80 C81.9877797,80 65.3659077,74.0472146 51.9943761,64.0016357 C47.9600255,69.3730625 44.8061777,75.4436199 42.747122,81.9990174 Z" opacity=".25"></path><path d="M100,200 C44.7715223,200 0,155.228478 0,100 C0,44.7715223 44.7715223,0 100,0 C137.038592,0 169.374042,20.1365308 186.656057,50.0592979 C182.902635,56.5581213 178.439143,62.5953278 173.371615,68.0648818 C161.041547,39.7757571 132.830213,20 100,20 C55.8172178,20 20,55.8172178 20,100 C20,144.182782 55.8172178,180 100,180 C132.767816,180 160.934295,160.299342 173.301142,132.096319 C178.366895,137.552678 182.830857,143.575528 186.587453,150.059298 C169.288565,179.916659 136.989642,200 100,200 Z" />
                  </g>
                </svg>
              </a>
              <ul class="py-1.5 px-3 bg-gray-50/50 flex space-x-3 ring-(1 gray-200) rounded-full shadow">
                {%- for item in collections.all | eleventyNavigation %}
                <li class="py-1 px-2"><a href="{{ item.url }}" class="flex motion-safe:(transition) hover:(text-pri-500)">{{ item.key }}</a></li>
                {%- endfor %}
                <li class="py-1 px-2">
                  <button class="color-mode flex items-center motion-safe:(transition) hover:(text-blue-500)" aria-label="Toggle color mode">
                    <span class="block dark:(hidden)"><i class="fal fa-fw fa-sun"></i> <span class="sr-only">Switch to dark mode</span></span>
                    <span class="hidden dark:(block)"><i class="fal fa-fw fa-moon-stars"></i> <span class="sr-only">Switch to light mode</span></span>
                  </button>
                </li>
              </ul>
            </nav>
          </div>
        </header>
        
        <main class="w-full flex-1 relative">
          {{ content | safe }}
        </main>
      </div>

      <div class="h-72" aria-hidden="true"></div>

      <footer class="pt-16 w-full bg-(paper gray-100) flex-none relative z-10">
        <b class="bg-(grid fixed) text-gray-100 absolute inset-0 opacity-5 dark:(opacity-30)" aria-hidden="true"></b>
        <b class="h-16 bg-(repeat-x top) absolute inset-x-0 top-0 invert dark:(invert-0)" style="background-image: url('/_assets/img/bg-grunge-top.png');" aria-hidden="true"></b>
        <div class="mx-auto py-6 px-4 max-w-7xl flex-(& col) gap-16 relative lg:(px-8 flex-row)">
          <div class="mx-auto w-full max-w-[466px] space-y-12 lg:(mx-0 max-w-none flex-1)">
            {%- call heading.x(sub='My Book', ico='book') %}
            Foundation Fw
            {%- endcall %}
            <div class="flex-(& col) items-center gap-6 lg:(flex-row-reverse)">
              <p class="px-12 w-full lg:(px-0 flex-1)">{{ site.book.desc }}</p>
              <a href="https://amzn.com/dp/1430216182?tag=qrayg-20" class="fw-book group w-[207px] inline-flex flex-none transform [perspective:33rem] motion-safe:(transition) hover:(-rotate-3)">
                <figure role="group" class="fw-book-inner flex flex-row-reverse [transform-style:preserve-3d]">
                  <figcaption class="sr-only">{{ site.book.title }}</figcaption>
                  <figure class="fw-book-cover origin-left [transform:rotateY(35deg)] motion-safe:transition group-hover:([transform:rotateY(0)])">
                    <img src="/_assets/img/foundation-fw-cover.jpg" alt="Book cover" class="rounded-r motion-safe:transition group-hover:(rounded-sm shadow-lg)" />
                  </figure>
                  <figure class="fw-book-binding origin-right [transform:rotateY(-35deg)] motion-safe:transition group-hover:([transform:rotateY(-90deg)] opacity-0)">
                    <img src="/_assets/img/foundation-fw-binding.png" alt="Book binding" class="rounded-l" />
                  </figure>
                </figure>
              </a>
            </div>
            {%- call heading.x(sub='Social Media', ico='share-alt') %}
            Stalk Me
            {%- endcall %}
            <div class="flex justify-center lg:(justify-start)">
              {{ social.x(social=site.social, css='lg:w-16 lg:h-16 lg:text-2xl') }}
            </div>
          </div>
          <div class="mx-auto w-full max-w-[466px] space-y-12 lg:(mx-0)">
            {%- call heading.x(sub='Currently', ico='gamepad-alt') %}Playing{%- endcall %}
            <ul class="media-shelf mx-auto mb-16 pt-4 pb-16 px-2 w-full bg-bottom bg-no-repeat flex items-end justify-between lg:mb-32" style="background-image: url('/_assets/img/media-shelf.png');">
              {{ media(data=currently.playing, category='games') }}
            </ul>
            {%- call heading.x(sub='Currently', ico='list-music') %}Listening{%- endcall %}
            <ul class="media-shelf mx-auto mb-16 pt-4 pb-16 px-2 w-full bg-bottom bg-no-repeat flex items-end justify-between lg:mb-32" style="background-image: url('/_assets/img/media-shelf.png');">
              {{ media(data=currently.listening, category='music') }}
            </ul>
          </div>
        </div>
        <div class="w-full h-10 bg-(repeat-x top) invert dark:(invert-0)" style="background-image: url('/_assets/img/bg-grunge-bot.png');" aria-hidden="true"></div>
        <div class="mx-auto py-6 px-4 max-w-7xl flex-(& col) items-center gap-6 relative md:(px-8 flex-row justify-between)">
          <p class="text-xs font-bold uppercase">
            &copy;2008-{% year %}
            <a href="{{ site.meta.url }}" class="group mx-1.5 relative motion-safe:(transition) hover:(text-pri-500)">
              {{ site.meta.author }}
              <b class="w-full h-px bg-current transform absolute -bottom-px left-0 scale-0 motion-safe:(transition) group-hover:(scale-100)"></b>
            </a>
          </p>
          <ul class="p-2 flex items-center gap-x-4 md:(gap-x-6)">
            {%- for nav in site.tech %}
            <li>
              <a href="{{ nav.url }}" class="group block relative motion-safe:(transition hover:(animate-blob)) hover:(text-pri-500)">
                {%- call tooltip.x() %}
                  {{ nav.sub }}: {{ nav.title }}
                {%- endcall %}
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 40 40" role="img" class="w-6 fill-current">
                  {{ nav.ico | safe }}
                </svg>
              </a>
            </li>
            {%- endfor %}
          </ul>
        </div>
      </footer>

      <div class="bg-src flex items-center fixed inset-0 z-0 pointer-events-none" aria-hidden="true">
        <div class="w-full bg-slate-900 dark:(bg-slate-900)">
          {%- highlight "html" %}
          {% include "html/home.html" %}
          {%- endhighlight %}
        </div>
        <div class="bg-slate-50/50 absolute inset-0"></div>
        <div class="bg-grid absolute inset-0 opacity-5 dark:(opacity-20)"></div>
      </div>

    </div>

    {% renderblock 'js' %}
    <script src="/_assets/js/_app.js?v={% bust %}"></script>
    <script src="https://kit.fontawesome.com/a2bf4ed495.js" crossorigin="anonymous"></script>

  </body>

</html>